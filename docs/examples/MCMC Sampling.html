
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>MCMC Sampling &#8212; CmdStanPy 1.0.0rc1 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/project-template.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Maximum Likelihood Estimation" href="Maximum%20Likelihood%20Estimation.html" />
    <link rel="prev" title="CmdStanPy Examples" href="../examples.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<link rel="stylesheet" href="_static/basic.css" type="text/css" />

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
<nav id="navbar-main" class="navbar navbar-dark navbar-expand-lg fixed-top bd-navbar"
    style="background-color: #222222;"><div class="container-xl">

  <div id="navbar-start">
    
    <!-- This will display the version of the docs -->
<a class='navbar-brand' href='index.html'>CmdStanPy 1.0.0rc1</a>
    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../overview.html">
  Overview
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../installation.html">
  Installation
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../hello_world.html">
  “Hello, World”
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../workflow.html">
  CmdStanPy Workflow
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../examples.html">
  CmdStanPy Examples
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api.html">
  API Reference
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/mcmc_stan" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/stan-dev/cmdstanpy" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://discourse.mc-stan.org/" rel="noopener" target="_blank" title="Forums">
            <span><i class="fas fa-users"></i></span>
            <label class="sr-only">Forums</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
</nav>


    <div class="container-xl">
      <div class="row">
          
            
            <div class="col-12 col-md-1 col-xl-2 bd-sidebar no-sidebar"></div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                <form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
              </div>
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Prerequisites">
   Prerequisites
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Fitting-a-model-to-data">
   Fitting a model to data
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#Sampler-Progress">
     Sampler Progress
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Running-a-data-generating-model">
   Running a data-generating model
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                

<div class="tocsection editthispage">
    <a href="https://github.com/stan-dev/cmdstanpy/edit/develop/docsrc/examples/MCMC Sampling.ipynb">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-11 col-xl-8 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="MCMC-Sampling">
<h1>MCMC Sampling<a class="headerlink" href="#MCMC-Sampling" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">CmdStanModel</span></code> class method <code class="docutils literal notranslate"><span class="pre">sample</span></code> invokes Stan’s adaptive HMC-NUTS sampler which uses the Hamiltonian Monte Carlo (HMC) algorithm and its adaptive variant the no-U-turn sampler (NUTS) to produce a set of draws from the posterior distribution of the model parameters conditioned on the data. It returns a <code class="docutils literal notranslate"><span class="pre">CmdStanMCMC</span></code> object which provides properties to retrieve information about the sample, as well as methods to run CmdStan’s summary and diagnostics tools.</p>
<p>In order to evaluate the fit of the model to the data, it is necessary to run several Monte Carlo chains and compare the set of draws returned by each. By default, the <code class="docutils literal notranslate"><span class="pre">sample</span></code> command runs 4 sampler chains, i.e., CmdStanPy invokes CmdStan 4 times. CmdStanPy uses Python’s <code class="docutils literal notranslate"><span class="pre">subprocess</span></code> and <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> libraries to run these chains in separate processes. This processing can be done in parallel, up to the number of processor cores available.</p>
<section id="Prerequisites">
<h2>Prerequisites<a class="headerlink" href="#Prerequisites" title="Permalink to this headline">¶</a></h2>
<p>CmdStanPy displays progress bars during sampling via use of package <a class="reference external" href="https://github.com/tqdm/tqdm">tqdm</a>. In order for these to display properly, you must have the <a class="reference external" href="https://ipywidgets.readthedocs.io/en/latest/index.html">ipywidgets</a> package installed, and depending on your version of Jupyter or JupyterLab, you must enable it via command:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">!</span>jupyter nbextension <span class="nb">enable</span> --py widgetsnbextension
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
usage: jupyter [-h] [--version] [--config-dir] [--data-dir] [--runtime-dir]
               [--paths] [--json] [--debug]
               [subcommand]

Jupyter: Interactive Computing

positional arguments:
  subcommand     the subcommand to launch

optional arguments:
  -h, --help     show this help message and exit
  --version      show the versions of core jupyter packages and exit
  --config-dir   show Jupyter config dir
  --data-dir     show Jupyter data dir
  --runtime-dir  show Jupyter runtime dir
  --paths        show all Jupyter paths. Add --json for machine-readable
                 format.
  --json         output paths as machine-readable json
  --debug        output debug information about paths

Available subcommands: dejavu kernel kernelspec migrate nbconvert run
troubleshoot trust

Jupyter command `jupyter-nbextension` not found.
</pre></div></div>
</div>
<p>For more information, see the the <a class="reference external" href="https://ipywidgets.readthedocs.io/en/latest/user_install.html#">installation instructions</a>, also <a class="reference external" href="https://github.com/tqdm/tqdm/issues/394#issuecomment-384743637">this tqdm GitHub issue</a>.</p>
</section>
<section id="Fitting-a-model-to-data">
<h2>Fitting a model to data<a class="headerlink" href="#Fitting-a-model-to-data" title="Permalink to this headline">¶</a></h2>
<p>In this example we use the CmdStan example model <a class="reference external" href="https://github.com/stan-dev/cmdstanpy/blob/master/test/data/bernoulli.stan">bernoulli.stan</a> and data file <a class="reference external" href="https://github.com/stan-dev/cmdstanpy/blob/master/test/data/bernoulli.data.json%3E">bernoulli.data.json</a>.</p>
<p>We instantiate a <code class="docutils literal notranslate"><span class="pre">CmdStanModel</span></code> from the Stan program file</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">cmdstanpy</span> <span class="kn">import</span> <span class="n">CmdStanModel</span><span class="p">,</span> <span class="n">cmdstan_path</span>

<span class="n">bernoulli_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmdstan_path</span><span class="p">(),</span> <span class="s1">&#39;examples&#39;</span><span class="p">,</span> <span class="s1">&#39;bernoulli&#39;</span><span class="p">)</span>
<span class="n">stan_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bernoulli_dir</span><span class="p">,</span> <span class="s1">&#39;bernoulli.stan&#39;</span><span class="p">)</span>
<span class="n">data_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bernoulli_dir</span><span class="p">,</span> <span class="s1">&#39;bernoulli.data.json&#39;</span><span class="p">)</span>

<span class="c1"># instantiate, compile bernoulli model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CmdStanModel</span><span class="p">(</span><span class="n">stan_file</span><span class="o">=</span><span class="n">stan_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:cmdstanpy:found newer exe file, not recompiling
INFO:cmdstanpy:compiled model file: /home/runner/.cmdstan/cmdstan-2.28.0/examples/bernoulli/bernoulli
</pre></div></div>
</div>
<p>By default, the model is compiled during instantiation. The compiled executable is created in the same directory as the program file. If the directory already contains an executable file with a newer timestamp, the model is not recompiled.</p>
<p>We run the sampler on the data using all default settings: 4 chains, each of which runs 1000 warmup and sampling iterations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># run CmdStan&#39;s sample method, returns object `CmdStanMCMC`</span>
<span class="n">fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:cmdstanpy:sampling: [&#39;/home/runner/.cmdstan/cmdstan-2.28.0/examples/bernoulli/bernoulli&#39;, &#39;id=1&#39;, &#39;random&#39;, &#39;seed=44666&#39;, &#39;data&#39;, &#39;file=/home/runner/.cmdstan/cmdstan-2.28.0/examples/bernoulli/bernoulli.data.json&#39;, &#39;output&#39;, &#39;file=/tmp/tmp6ndnm29s/bernoulli-20211019133600-1-u90vky8_.csv&#39;, &#39;method=sample&#39;, &#39;algorithm=hmc&#39;, &#39;adapt&#39;, &#39;engaged=1&#39;]
ERROR:cmdstanpy:Error in progress bar initialization:
        IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
Disabling progress bars for this session
Exception ignored in: &lt;function tqdm.__del__ at 0x7f00b824c1f0&gt;
Traceback (most recent call last):
  File &#34;/opt/hostedtoolcache/Python/3.9.7/x64/lib/python3.9/site-packages/tqdm/std.py&#34;, line 1147, in __del__
    self.close()
  File &#34;/opt/hostedtoolcache/Python/3.9.7/x64/lib/python3.9/site-packages/tqdm/notebook.py&#34;, line 286, in close
    self.disp(bar_style=&#39;danger&#39;, check_delay=False)
AttributeError: &#39;tqdm&#39; object has no attribute &#39;disp&#39;
Exception ignored in: &lt;function tqdm.__del__ at 0x7f00b824c1f0&gt;
Traceback (most recent call last):
  File &#34;/opt/hostedtoolcache/Python/3.9.7/x64/lib/python3.9/site-packages/tqdm/std.py&#34;, line 1147, in __del__
    self.close()
  File &#34;/opt/hostedtoolcache/Python/3.9.7/x64/lib/python3.9/site-packages/tqdm/notebook.py&#34;, line 286, in close
    self.disp(bar_style=&#39;danger&#39;, check_delay=False)
AttributeError: &#39;tqdm&#39; object has no attribute &#39;disp&#39;
INFO:cmdstanpy:start chain 3
INFO:cmdstanpy:start chain 4
INFO:cmdstanpy:sampling completed
</pre></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">sample</span></code> method returns a <code class="docutils literal notranslate"><span class="pre">CmdStanMCMC</span></code> object, which contains: - metadata - draws - HMC tuning parameters <code class="docutils literal notranslate"><span class="pre">metric</span></code>, <code class="docutils literal notranslate"><span class="pre">step_size</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sampler diagnostic variables:</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">method_vars_cols</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stan model variables:</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">stan_vars_cols</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
sampler diagnostic variables:
dict_keys([&#39;lp__&#39;, &#39;accept_stat__&#39;, &#39;stepsize__&#39;, &#39;treedepth__&#39;, &#39;n_leapfrog__&#39;, &#39;divergent__&#39;, &#39;energy__&#39;])
stan model variables:
dict_keys([&#39;theta&#39;])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean</th>
      <th>MCSE</th>
      <th>StdDev</th>
      <th>5%</th>
      <th>50%</th>
      <th>95%</th>
      <th>N_Eff</th>
      <th>N_Eff/s</th>
      <th>R_hat</th>
    </tr>
    <tr>
      <th>name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>lp__</th>
      <td>-7.30</td>
      <td>0.0230</td>
      <td>0.82</td>
      <td>-8.900</td>
      <td>-7.00</td>
      <td>-6.70</td>
      <td>1300.0</td>
      <td>21000.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>theta</th>
      <td>0.25</td>
      <td>0.0032</td>
      <td>0.12</td>
      <td>0.074</td>
      <td>0.24</td>
      <td>0.47</td>
      <td>1400.0</td>
      <td>23000.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The sampling data from the fit can be accessed either as a <code class="docutils literal notranslate"><span class="pre">numpy</span></code> array or a pandas <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">draws</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">fit</span><span class="o">.</span><span class="n">draws_pd</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(1000, 4, 8)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lp__</th>
      <th>accept_stat__</th>
      <th>stepsize__</th>
      <th>treedepth__</th>
      <th>n_leapfrog__</th>
      <th>divergent__</th>
      <th>energy__</th>
      <th>theta</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-7.46706</td>
      <td>1.000000</td>
      <td>0.928629</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>7.74438</td>
      <td>0.123063</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-6.81714</td>
      <td>1.000000</td>
      <td>0.928629</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>7.38157</td>
      <td>0.205553</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-6.90496</td>
      <td>0.993293</td>
      <td>0.928629</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>6.90842</td>
      <td>0.184680</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-6.82746</td>
      <td>1.000000</td>
      <td>0.928629</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>6.89321</td>
      <td>0.202514</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-6.75690</td>
      <td>0.880840</td>
      <td>0.928629</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>7.64382</td>
      <td>0.233591</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Additionally, if <code class="docutils literal notranslate"><span class="pre">xarray</span></code> is installed, this data can be accessed another way:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit</span><span class="o">.</span><span class="n">draws_xr</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">RuntimeError</span>                              Traceback (most recent call last)
<span class="ansi-green-fg">/tmp/ipykernel_4006/564936507.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>fit<span class="ansi-blue-fg">.</span>draws_xr<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/work/cmdstanpy/cmdstanpy/cmdstanpy/stanfit.py</span> in <span class="ansi-cyan-fg">draws_xr</span><span class="ansi-blue-fg">(self, vars, inc_warmup)</span>
<span class="ansi-green-intense-fg ansi-bold">    931</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    932</span>         <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> XARRAY_INSTALLED<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 933</span><span class="ansi-red-fg">             raise RuntimeError(
</span><span class="ansi-green-intense-fg ansi-bold">    934</span>                 <span class="ansi-blue-fg">&#39;Package &#34;xarray&#34; is not installed, cannot produce draws array.&#39;</span>
<span class="ansi-green-intense-fg ansi-bold">    935</span>             )

<span class="ansi-red-fg">RuntimeError</span>: Package &#34;xarray&#34; is not installed, cannot produce draws array.
</pre></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">fit</span></code> object records the command, the return code, and the paths to the sampler output csv and console files. The string representation of this object displays the CmdStan commands and the location of the output files.</p>
<p>Output filenames are composed of the model name, a timestamp in the form YYYYMMDDhhmm and the chain id, plus the corresponding filetype suffix, either ‘.csv’ for the CmdStan output or ‘.txt’ for the console messages, e.g. <code class="docutils literal notranslate"><span class="pre">bernoulli-201912081451-1.csv</span></code>. Output files written to the temporary directory contain an additional 8-character random string, e.g. <code class="docutils literal notranslate"><span class="pre">bernoulli-201912081451-1-5nm6as7u.csv</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
CmdStanMCMC: model=bernoulli chains=4[&#39;method=sample&#39;, &#39;algorithm=hmc&#39;, &#39;adapt&#39;, &#39;engaged=1&#39;]
 csv_files:
        /tmp/tmp6ndnm29s/bernoulli-20211019133600-1-u90vky8_.csv
        /tmp/tmp6ndnm29s/bernoulli-20211019133600-2-wr72mp_5.csv
        /tmp/tmp6ndnm29s/bernoulli-20211019133600-3-m_pdxmhw.csv
        /tmp/tmp6ndnm29s/bernoulli-20211019133600-4-rknceq3w.csv
 output_files:
        /tmp/tmp6ndnm29s/bernoulli-20211019133600-1-u90vky8_-stdout.txt
        /tmp/tmp6ndnm29s/bernoulli-20211019133600-2-wr72mp_5-stdout.txt
        /tmp/tmp6ndnm29s/bernoulli-20211019133600-3-m_pdxmhw-stdout.txt
        /tmp/tmp6ndnm29s/bernoulli-20211019133600-4-rknceq3w-stdout.txt
</pre></div></div>
</div>
<p>The sampler output files are written to a temporary directory which is deleted upon session exit unless the <code class="docutils literal notranslate"><span class="pre">output_dir</span></code> argument is specified. The <code class="docutils literal notranslate"><span class="pre">save_csvfiles</span></code> function moves the CmdStan CSV output files to a specified directory without having to re-run the sampler. The console output files are not saved. These files are treated as ephemeral; if the sample is valid, all relevant information is recorded in the CSV files.</p>
<section id="Sampler-Progress">
<h3>Sampler Progress<a class="headerlink" href="#Sampler-Progress" title="Permalink to this headline">¶</a></h3>
<p>Your model make take a long time to fit. The <code class="docutils literal notranslate"><span class="pre">sample</span></code> method provides two arguments:</p>
<ul class="simple">
<li><p>visual progress bar: <code class="docutils literal notranslate"><span class="pre">show_progress=True</span></code></p></li>
<li><p>stream CmdStan ouput to the console - <code class="docutils literal notranslate"><span class="pre">show_console=True</span></code></p></li>
</ul>
<p>To illustrate how progress bars work, we will run the bernoulli model. Since the progress bars are only visible while the sampler is running and the bernoulli model takes no time at all to fit, we run this model for 200K iterations, in order to see the progress bars in action.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_file</span><span class="p">,</span> <span class="n">iter_warmup</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">iter_sampling</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">show_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:cmdstanpy:sampling: [&#39;/home/runner/.cmdstan/cmdstan-2.28.0/examples/bernoulli/bernoulli&#39;, &#39;id=1&#39;, &#39;random&#39;, &#39;seed=24823&#39;, &#39;data&#39;, &#39;file=/home/runner/.cmdstan/cmdstan-2.28.0/examples/bernoulli/bernoulli.data.json&#39;, &#39;output&#39;, &#39;file=/tmp/tmp6ndnm29s/bernoulli-20211019133600-1-s8pwqv99.csv&#39;, &#39;method=sample&#39;, &#39;num_samples=100000&#39;, &#39;num_warmup=100000&#39;, &#39;algorithm=hmc&#39;, &#39;adapt&#39;, &#39;engaged=1&#39;]
INFO:cmdstanpy:start chain 1
INFO:cmdstanpy:start chain 2
INFO:cmdstanpy:finish chain 1
INFO:cmdstanpy:start chain 3
INFO:cmdstanpy:finish chain 2
INFO:cmdstanpy:start chain 4
INFO:cmdstanpy:finish chain 4
INFO:cmdstanpy:finish chain 3
INFO:cmdstanpy:sampling completed
</pre></div></div>
</div>
<p>The Stan language <code class="docutils literal notranslate"><span class="pre">print</span></code> statement can be use to monitor the Stan program state. In order to see this information as the sampler is running, use the <code class="docutils literal notranslate"><span class="pre">show_console=True</span></code> argument. This will stream all CmdStan messages to the terminal while the sampler is running.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data_file</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">parallel_chains</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">show_console</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:cmdstanpy:sampling: [&#39;/home/runner/.cmdstan/cmdstan-2.28.0/examples/bernoulli/bernoulli&#39;, &#39;id=1&#39;, &#39;random&#39;, &#39;seed=48639&#39;, &#39;data&#39;, &#39;file=/home/runner/.cmdstan/cmdstan-2.28.0/examples/bernoulli/bernoulli.data.json&#39;, &#39;output&#39;, &#39;file=/tmp/tmp6ndnm29s/bernoulli-20211019133607-1-dn90ftr5.csv&#39;, &#39;method=sample&#39;, &#39;algorithm=hmc&#39;, &#39;adapt&#39;, &#39;engaged=1&#39;]
INFO:cmdstanpy:start chain 1
INFO:cmdstanpy:finish chain 1
INFO:cmdstanpy:start chain 2
INFO:cmdstanpy:finish chain 2
INFO:cmdstanpy:sampling completed
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
chain 1: method = sample (Default)
chain 1: sample
chain 1: num_samples = 1000 (Default)
chain 1: num_warmup = 1000 (Default)
chain 1: save_warmup = 0 (Default)
chain 1: thin = 1 (Default)
chain 1: adapt
chain 1: engaged = 1 (Default)
chain 1: gamma = 0.050000000000000003 (Default)
chain 1: delta = 0.80000000000000004 (Default)
chain 1: kappa = 0.75 (Default)
chain 1: t0 = 10 (Default)
chain 1: init_buffer = 75 (Default)
chain 1: term_buffer = 50 (Default)
chain 1: window = 25 (Default)
chain 1: algorithm = hmc (Default)
chain 1: hmc
chain 1: engine = nuts (Default)
chain 1: nuts
chain 1: max_depth = 10 (Default)
chain 1: metric = diag_e (Default)
chain 1: metric_file =  (Default)
chain 1: stepsize = 1 (Default)
chain 1: stepsize_jitter = 0 (Default)
chain 1: num_chains = 1 (Default)
chain 1: id = 1 (Default)
chain 1: data
chain 1: file = /home/runner/.cmdstan/cmdstan-2.28.0/examples/bernoulli/bernoulli.data.json
chain 1: init = 2 (Default)
chain 1: random
chain 1: seed = 48639
chain 1: output
chain 1: file = /tmp/tmp6ndnm29s/bernoulli-20211019133607-1-dn90ftr5.csv
chain 1: diagnostic_file =  (Default)
chain 1: refresh = 100 (Default)
chain 1: sig_figs = -1 (Default)
chain 1: profile_file = profile.csv (Default)
chain 1: num_threads = 1 (Default)
chain 1:
chain 1:
chain 1: Gradient evaluation took 0.000157 seconds
chain 1: 1000 transitions using 10 leapfrog steps per transition would take 1.57 seconds.
chain 1: Adjust your expectations accordingly!
chain 1:
chain 1:
chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
chain 1: Iteration:  100 / 2000 [  5%]  (Warmup)
chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
chain 1: Iteration:  300 / 2000 [ 15%]  (Warmup)
chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
chain 1: Iteration:  500 / 2000 [ 25%]  (Warmup)
chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
chain 1: Iteration:  700 / 2000 [ 35%]  (Warmup)
chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
chain 1: Iteration:  900 / 2000 [ 45%]  (Warmup)
chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
chain 1: Iteration: 1100 / 2000 [ 55%]  (Sampling)
chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
chain 1: Iteration: 1300 / 2000 [ 65%]  (Sampling)
chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
chain 1: Iteration: 1500 / 2000 [ 75%]  (Sampling)
chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
chain 1: Iteration: 1700 / 2000 [ 85%]  (Sampling)
chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
chain 1: Iteration: 1900 / 2000 [ 95%]  (Sampling)
chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
chain 1:
chain 1: Elapsed Time: 0.007 seconds (Warm-up)
chain 1: 0.016 seconds (Sampling)
chain 1: 0.023 seconds (Total)
chain 1:
chain 1:
chain 2: method = sample (Default)
chain 2: sample
chain 2: num_samples = 1000 (Default)
chain 2: num_warmup = 1000 (Default)
chain 2: save_warmup = 0 (Default)
chain 2: thin = 1 (Default)
chain 2: adapt
chain 2: engaged = 1 (Default)
chain 2: gamma = 0.050000000000000003 (Default)
chain 2: delta = 0.80000000000000004 (Default)
chain 2: kappa = 0.75 (Default)
chain 2: t0 = 10 (Default)
chain 2: init_buffer = 75 (Default)
chain 2: term_buffer = 50 (Default)
chain 2: window = 25 (Default)
chain 2: algorithm = hmc (Default)
chain 2: hmc
chain 2: engine = nuts (Default)
chain 2: nuts
chain 2: max_depth = 10 (Default)
chain 2: metric = diag_e (Default)
chain 2: metric_file =  (Default)
chain 2: stepsize = 1 (Default)
chain 2: stepsize_jitter = 0 (Default)
chain 2: num_chains = 1 (Default)
chain 2: id = 2
chain 2: data
chain 2: file = /home/runner/.cmdstan/cmdstan-2.28.0/examples/bernoulli/bernoulli.data.json
chain 2: init = 2 (Default)
chain 2: random
chain 2: seed = 48639
chain 2: output
chain 2: file = /tmp/tmp6ndnm29s/bernoulli-20211019133607-2-c5dwkdft.csv
chain 2: diagnostic_file =  (Default)
chain 2: refresh = 100 (Default)
chain 2: sig_figs = -1 (Default)
chain 2: profile_file = profile.csv (Default)
chain 2: num_threads = 1 (Default)
chain 2:
chain 2:
chain 2: Gradient evaluation took 2e-06 seconds
chain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.02 seconds.
chain 2: Adjust your expectations accordingly!
chain 2:
chain 2:
chain 2: Iteration:    1 / 2000 [  0%]  (Warmup)
chain 2: Iteration:  100 / 2000 [  5%]  (Warmup)
chain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)
chain 2: Iteration:  300 / 2000 [ 15%]  (Warmup)
chain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)
chain 2: Iteration:  500 / 2000 [ 25%]  (Warmup)
chain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)
chain 2: Iteration:  700 / 2000 [ 35%]  (Warmup)
chain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)
chain 2: Iteration:  900 / 2000 [ 45%]  (Warmup)
chain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)
chain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)
chain 2: Iteration: 1100 / 2000 [ 55%]  (Sampling)
chain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)
chain 2: Iteration: 1300 / 2000 [ 65%]  (Sampling)
chain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)
chain 2: Iteration: 1500 / 2000 [ 75%]  (Sampling)
chain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)
chain 2: Iteration: 1700 / 2000 [ 85%]  (Sampling)
chain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)
chain 2: Iteration: 1900 / 2000 [ 95%]  (Sampling)
chain 2: Iteration: 2000 / 2000 [100%]  (Sampling)
chain 2:
chain 2:  Elapsed Time: 0.004 seconds (Warm-up)
chain 2:                0.015 seconds (Sampling)
chain 2:                0.019 seconds (Total)
chain 2:
chain 2:
</pre></div></div>
</div>
</section>
</section>
<section id="Running-a-data-generating-model">
<h2>Running a data-generating model<a class="headerlink" href="#Running-a-data-generating-model" title="Permalink to this headline">¶</a></h2>
<p>In this example we use the CmdStan example model <a class="reference external" href="https://github.com/stan-dev/cmdstanpy/blob/master/docs/notebooks/data_filegen.stan">data_filegen.stan</a> to generate a simulated dataset given fixed data values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model_datagen</span> <span class="o">=</span> <span class="n">CmdStanModel</span><span class="p">(</span><span class="n">stan_file</span><span class="o">=</span><span class="s1">&#39;bernoulli_datagen.stan&#39;</span><span class="p">)</span>
<span class="n">datagen_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span><span class="mi">300</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">:</span><span class="mf">0.3</span><span class="p">}</span>
<span class="n">fit_sim</span> <span class="o">=</span> <span class="n">model_datagen</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">datagen_data</span><span class="p">,</span> <span class="n">fixed_param</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fit_sim</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:cmdstanpy:compiling stan program, exe file: /home/runner/work/cmdstanpy/cmdstanpy/docsrc/examples/bernoulli_datagen
INFO:cmdstanpy:compiler options: stanc_options={}, cpp_options={}
INFO:cmdstanpy:compiled model file: /home/runner/work/cmdstanpy/cmdstanpy/docsrc/examples/bernoulli_datagen
INFO:cmdstanpy:sampling: [&#39;/home/runner/work/cmdstanpy/cmdstanpy/docsrc/examples/bernoulli_datagen&#39;, &#39;id=1&#39;, &#39;random&#39;, &#39;seed=96469&#39;, &#39;data&#39;, &#39;file=/tmp/tmp6ndnm29s/tx9uh4p9.json&#39;, &#39;output&#39;, &#39;file=/tmp/tmp6ndnm29s/bernoulli_datagen-20211019133614-1-qaadjn46.csv&#39;, &#39;method=sample&#39;, &#39;algorithm=fixed_param&#39;]
INFO:cmdstanpy:start chain 1
INFO:cmdstanpy:finish chain 1
INFO:cmdstanpy:sampling completed
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean</th>
      <th>MCSE</th>
      <th>StdDev</th>
      <th>5%</th>
      <th>50%</th>
      <th>95%</th>
      <th>N_Eff</th>
      <th>N_Eff/s</th>
      <th>R_hat</th>
    </tr>
    <tr>
      <th>name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>lp__</th>
      <td>0</td>
      <td>NaN</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>theta_rep</th>
      <td>90</td>
      <td>0.27</td>
      <td>8</td>
      <td>77</td>
      <td>90</td>
      <td>100.0</td>
      <td>860.0</td>
      <td>120000.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Compute, plot histogram of total successes for <code class="docutils literal notranslate"><span class="pre">N</span></code> Bernoulli trials with chance of success <code class="docutils literal notranslate"><span class="pre">theta</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">drawset_pd</span> <span class="o">=</span> <span class="n">fit_sim</span><span class="o">.</span><span class="n">draws_pd</span><span class="p">()</span>
<span class="n">drawset_pd</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># restrict to columns over new outcomes of N Bernoulli trials</span>
<span class="n">y_sims</span> <span class="o">=</span> <span class="n">drawset_pd</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lp__&#39;</span><span class="p">,</span> <span class="s1">&#39;accept_stat__&#39;</span><span class="p">])</span>

<span class="c1"># plot total number of successes per draw</span>
<span class="n">y_sums</span> <span class="o">=</span> <span class="n">y_sims</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_sums</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">datagen_data</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:matplotlib.font_manager:Failed to extract font properties from /usr/share/fonts/truetype/noto/NotoColorEmoji.ttf: In FT2Font: Can not load face.  Unknown file format.
INFO:matplotlib.font_manager:generated new fontManager
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:ylabel=&#39;Frequency&#39;&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_MCMC_Sampling_25_2.png" src="../_images/examples_MCMC_Sampling_25_2.png" />
</div>
</div>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../examples.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">CmdStanPy Examples</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Maximum%20Likelihood%20Estimation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Maximum Likelihood Estimation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Stan Development Team.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>